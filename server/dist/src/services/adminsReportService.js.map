{"version":3,"file":"adminsReportService.js","sources":["src/services/adminsReportService.ts"],"sourceRoot":"/","sourcesContent":["import prisma from \"../lib/prisma.js\";\n\nexport async function getTruckingReport() {\n  const overWeightReport = await prisma.truckingLog.findMany({\n    where: {\n      endingMileage: { not: null },\n    },\n    select: {\n      id: true,\n      startingMileage: true,\n      endingMileage: true,\n      Truck: {\n        select: {\n          id: true,\n          name: true,\n        },\n      },\n      Trailer: {\n        select: {\n          id: true,\n          name: true,\n        },\n      },\n      TimeSheet: {\n        select: {\n          User: {\n            select: {\n              firstName: true,\n              lastName: true,\n            },\n          },\n          date: true,\n          comment: true,\n          Jobsite: {\n            select: { name: true },\n          },\n        },\n      },\n      EquipmentHauled: {\n        select: {\n          truckingLogId: true,\n          Equipment: { select: { name: true, id: true } },\n          source: true,\n          destination: true,\n          startMileage: true,\n          endMileage: true,\n        },\n      },\n      Materials: {\n        select: {\n          truckingLogId: true,\n          name: true,\n          LocationOfMaterial: true,\n          quantity: true,\n          unit: true,\n        },\n      },\n      RefuelLogs: {\n        select: {\n          truckingLogId: true,\n          milesAtFueling: true,\n          gallonsRefueled: true,\n        },\n      },\n      StateMileages: {\n        select: {\n          truckingLogId: true,\n          state: true,\n          stateLineMileage: true,\n        },\n      },\n    },\n  });\n\n  const formattedReport = overWeightReport.map((log) => ({\n    id: log.id,\n    driver: `${log.TimeSheet?.User?.firstName} ${log.TimeSheet?.User?.lastName}`,\n    truckId: log.Truck?.id ?? null,\n    truckName: log.Truck?.name ?? null,\n    trailerId: log.Trailer?.id ?? null,\n    trailerName: log.Trailer?.name ?? null,\n    date: log.TimeSheet?.date ?? null,\n    jobId: log.TimeSheet?.Jobsite?.name ?? null,\n    Equipment: log.EquipmentHauled.map((equipment) => ({\n      name: equipment.Equipment?.name || \"\",\n      id: equipment.Equipment?.id || null,\n      source: equipment.source,\n      destination: equipment.destination,\n      startMileage: equipment.startMileage,\n      endMileage: equipment.endMileage,\n    })),\n    Materials: log.Materials.map((material) => ({\n      id: material.truckingLogId,\n      name: material.name,\n      location: material.LocationOfMaterial,\n      quantity: material.quantity,\n      unit: material.unit,\n    })),\n    StartingMileage: log.startingMileage,\n    Fuel: log.RefuelLogs.map((fuel) => ({\n      id: fuel.truckingLogId,\n      milesAtFueling: fuel.milesAtFueling,\n      gallonsRefueled: fuel.gallonsRefueled,\n    })),\n    StateMileages: log.StateMileages.map((state) => ({\n      id: state.truckingLogId,\n      state: state.state,\n      stateLineMileage: state.stateLineMileage,\n    })),\n    EndingMileage: log.endingMileage,\n    notes: log.TimeSheet?.comment ?? null,\n  }));\n\n  return formattedReport;\n}\n// Define a type for the Tasco report row\ntype TascoReportRow = {\n  id: string;\n  shiftType: string;\n  submittedDate: Date;\n  employee: string;\n  dateWorked: Date;\n  laborType: string | null;\n  equipment: string;\n  loadsABCDE: number | null;\n  loadsF: number | null;\n  materials: string;\n  startTime: Date;\n  endTime: Date | null;\n  LoadType: \"SCREENED\" | \"UNSCREENED\";\n};\n\nexport async function getTascoReport(): Promise<TascoReportRow[]> {\n  const report = await prisma.timeSheet.findMany({\n    select: {\n      date: true,\n      startTime: true,\n      endTime: true,\n      User: {\n        select: {\n          firstName: true,\n          lastName: true,\n        },\n      },\n      TascoLogs: {\n        select: {\n          id: true,\n          shiftType: true,\n          laborType: true,\n          Equipment: {\n            select: {\n              name: true,\n            },\n          },\n          screenType: true,\n          LoadQuantity: true,\n          materialType: true,\n        },\n      },\n    },\n  });\n\n  // Filter out timesheets with empty TascoLogs arrays\n  const filteredReport = report.filter(\n    (item) => Array.isArray(item.TascoLogs) && item.TascoLogs.length > 0\n  );\n\n  const tascoReport: TascoReportRow[] = filteredReport\n    .filter((log) => Array.isArray(log.TascoLogs) && log.TascoLogs.length > 0)\n    .map((log) => {\n      const firstLog = log.TascoLogs[0];\n      if (!firstLog) {\n        // Should not happen due to filter, but for type safety\n        throw new Error(\"TascoLog entry missing for timesheet\");\n      }\n      const shiftType = firstLog.shiftType;\n      const laborType = firstLog.laborType ?? null;\n      const loadQuantity = firstLog.LoadQuantity ?? 0;\n      const loadsABCDE =\n        shiftType === \"ABCD Shift\" || shiftType === \"E Shift\"\n          ? loadQuantity\n          : null;\n      const loadsF = shiftType === \"F Shift\" ? loadQuantity : null;\n      let loadType: \"SCREENED\" | \"UNSCREENED\" = \"UNSCREENED\";\n      if (firstLog.screenType === \"SCREENED\") loadType = \"SCREENED\";\n\n      return {\n        id: firstLog.id,\n        shiftType: shiftType,\n        submittedDate: log.date,\n        employee: `${log.User.firstName} ${log.User.lastName}`,\n        dateWorked: log.date,\n        laborType: laborType,\n        equipment: firstLog.Equipment?.name ?? \"\",\n        loadsABCDE: loadsABCDE,\n        loadsF: loadsF,\n        materials: firstLog.materialType ?? \"\",\n        startTime: log.startTime,\n        endTime: log.endTime ?? null,\n        LoadType: loadType,\n      };\n    });\n\n  return tascoReport;\n}\n\nexport async function getMechanicReport() {\n  const report = await prisma.timeSheet.findMany({\n    select: {\n      date: true,\n      User: {\n        select: {\n          firstName: true,\n          lastName: true,\n        },\n      },\n      Maintenance: {\n        select: {\n          id: true,\n          hours: true,\n          description: true,\n          Equipment: {\n            select: {\n              name: true,\n            },\n          },\n        },\n      },\n    },\n  });\n\n  // Filter out timesheets with empty Maintenance arrays\n  const filteredReport = report.filter(\n    (item) => Array.isArray(item.Maintenance) && item.Maintenance.length > 0\n  );\n\n  // Flatten the data to have one row per mechanic project\n  const mechanicReport = filteredReport.flatMap((timesheet) =>\n    timesheet.Maintenance.map((project) => ({\n      id: project.id,\n      employeeName: `${timesheet.User.firstName} ${timesheet.User.lastName}`,\n      equipmentWorkedOn: project.Equipment?.name ?? \"Unknown Equipment\",\n      hours: project.hours ?? 0,\n      comments: project.description ?? \"\",\n      dateWorked: timesheet.date,\n    }))\n  );\n\n  return mechanicReport;\n}\n"],"names":[],"mappings":"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","debug_id":"d4d6e328-b9f0-5958-8e1b-0b1e8f5149d2"}